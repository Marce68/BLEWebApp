<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TooA BLE Monitor - Web Bluetooth App</title>
    
    <link rel="stylesheet" href="ble-mon-r2.css">

</head>
<body>
    <div class="container">
        <h1>
            <img src="android-chrome-192x192.png" alt="Milano Pro Black Matt" style="float:right;width:13%;height:13%;">
            BLE Monitor
        </h1>
        <p style = "font-size: small;"><i>Questa WebApp utilizza le Web Bluetooth API per dialogare con la macchina.<br>
            Assicurati di utilizzare un browser compatibile (es. Chrome) e che il Bluetooth sia abilitato.<br>
            Tra il dispositivo e la macchina è richiesto il "pairing" o associazione che avviene dal menù di sistema.<br>
            - PC Windows: <strong>Impostazioni</strong> >>> <strong>Dispositivi</strong> >>> 
            <strong>Aggiungi dispositivo Bluetooth o di altro tipo</strong></i> >>> [Connetti]<br>
            - PC linux: associa il dispositivo e attiva il flag #experimental-web-platform-features in about://flags<br>
            - MAC: ... da provare ... <br>
            - Android: [Connetti] >>> seleziona il dispositivo >>> [Associa], una notifica di pairing dovrebbe apparire automaticamente. Segui le istruzioni a schermo.<br>
            - iOS: funziona solo con il web browser Bluefy</p>

        <div class="section" style ="display: flex; text-align: center;">
            <p class="status" id="connectionStatus" style = "width: 20%;">Disconnesso</p>
            <button id="connectButton" class="primary">Connetti</button>
            <button id="disconnectButton" class="secondary" disabled>Disconnetti</button>
        </div>

        <fieldset id = "fieldsetQuery" class = "section" disabled>
            <form id="QueryForm">

                <img src="MproBlackMatt2-removebg-preview.png" alt="Milano Pro Black Matt" style="float:right;width:40%;height:40%;">
                <label>
                    <input type="radio" name="sceltaQuery" value="AA-01-00-01-02-00-00-E7-B0" id="radioGetStatus">
                    Get Status
                    <input type="checkbox" name="periodicQuery" id="chekboxPeriodicQuery">
                    Periodic Query
                </label>
                <br>
                        
                <div style="display: flex; align-items: center; gap: 0px; width: 60%;">
                    <label> Board SN: </label>
                    <input type="radio" name="sceltaQuery" value="AA-01-00-01-07-00-01-00-E8-E7" id="radioGetInfoBoardSN">
                    <label for="radioGetInfoBoardSN"> Get </label>
                    <input type="radio" name="sceltaQuery" value="AA-01-00-01-07-00-21-00-..." id="radioSetInfoBoardSN">
                    <label for="radioSetInfoBoardSN"> Set </label>
                </div>
                <input type="text" id="boardSN" style ="width: 50%;" placeholder="decoded response">
                <br>

                <div style="display: flex; align-items: center; gap: 0px; width: 60%;">
                    <label> Machine SN: </label>
                    <input type="radio" name="sceltaQuery" value="AA-01-00-01-07-00-01-01-28-26" id="radioGetInfoMachineSN">
                    <label for="radioGetInfoMachineSN"> Get </label>
                    <input type="radio" name="sceltaQuery" value="AA-01-00-01-07-00-21-01-..." id="radioSetInfoMachineSN">
                    <label for="radioSetInfoMachineSN"> Set </label>
                </div>
                <input type="text" id="machineSN" style ="width: 50%;" placeholder="decoded response">
                <br>

                <div style="display: flex; align-items: center; gap: 0px; width: 60%;">
                    <label> BLE Name: </label> 
                    <input type="radio" name="sceltaQuery" value="AA-01-00-01-07-00-01-02-29-66" id="radioGetInfoBLEName">
                    <label for="radioGetInfoBLEName"> Get </label>
                    <input type="radio" name="sceltaQuery" value="AA-01-00-01-07-00-21-02-..." id="radioSetInfoBLEName">
                    <label for="radioSetInfoBLEName"> Set </label>
                </div>        
                <input type="text" id="bleName" style ="width: 50%;" placeholder="decoded response">
                <br>

                <div style="display: flex; align-items: center; gap: 0px; width: 60%;">
                    <label> Parameter Ver.: </label>
                    <input type="radio" name="sceltaQuery" value="AA-01-00-01-07-00-01-03-E9-A7" id="radioGetInfoParamVersion">
                    <label for="radioGetInfoParamVersion"> Get </label>
                    <input type="radio" name="sceltaQuery" value="AA-01-00-01-07-00-21-03-..." id="radioSetInfoParamVersion">
                    <label for="radioSetInfoParamVersion"> Set </label>
                </div>
                <input type="text" id="paramVersion" style ="width: 50%;" placeholder="decoded response">
                <br>
                <br>

                <div style="display: flex; align-items: center; gap: 0px; width: 60%;">
                    <label> Firmware Version. </label>
                    <input type="radio" name="sceltaQuery" value="AA-01-00-01-01-00-00-E7-40" id="radioGetVersion">
                    <label for="radioGetVersion"> Get </label>
                    <input type="radio" name="sceltaQuery" value="filename.bin" id="fwUpdate">
                    <label for="fwUpdate"> Update </label>               
                </div>
                <input type="text" id="fwVersion" style ="width: 50%;" placeholder="decoded response">
                <br>
                <input type="file" id="fileInput" style="width: 60%;" single accept=".bin">
                <progress id="progressBar" value="0" max="100" style="width: 30%;"></progress>
                <span id="progressText">0%</span>

            </form> 

            <br>

            <input type="text" id="rxInput" placeholder="Query to send ...">
            <button id="writeRxButton" class="action" disabled> Send </button>
            <div id="txValue" style="font-size: small; color: #007bff;">Response raw data ...</div>

            <br>
            <hr>

            <form id="StatusForm">
                <div class="campo-multiplo">
                    <div class="input-group">
                        <label for="systemState">System State:</label>
                        <input type="text" id="systemState">
                    </div>

                    <div class="input-group">
                        <label for="cycleTimeDuration">Cycle time duration [s]:</label>
                        <input type="text" id="cycleTimeDuration">
                    </div>

                    <div class="input-group">
                        <label for="cycleTimeElapsed"">Cycle time elapsed [s]:</label>
                        <input type="text" id="cycleTimeElapsed">
                    </div>

                    <div class="input-group">
                        <label for="temperatureProbe">Probe Temp. [°C]:</label>
                        <input type="text" id="temperatureProbe">
                    </div>                
                </div>

                <div class="campo-multiplo">
                    <div class="input-group">
                        <label for="environmentTemp">Environment Temp. [°C]:</label>
                        <input type="text" id="environmentTemp">
                    </div>

                    <div class="input-group">
                        <label for="motorCurrent">Motor current [mA]:</label>
                        <input type="text" id="motorCurrent">
                    </div>

                    <div class="input-group">
                        <label for="peltierVoltage">TECs voltage [mV]:</label>
                        <input type="text" id="peltierVoltage">
                    </div>

                    <div class="input-group">
                        <label for="motorVoltage">Loads voltage [mV]:</label>
                        <input type="text" id="motorVoltage">
                    </div>                
                </div>

                <div class="campo-multiplo">
                    <div class="input-group">
                        <label for="motorFilteredCurrent">Motor filtered current [mA]:</label>
                        <input type="text" id="motorFilteredCurrent">
                    </div>

                    <div class="input-group">
                        <label for="motorDutyCycle">Motor duty cycle [%]:</label>
                        <input type="text" id="motorDutyCycle">
                    </div>

                    <div class="input-group">
                        <label for="motorRealVoltage">Motor voltage [mV]:</label>
                        <input type="text" id="motorRealVoltage">
                    </div>

                    <div class="input-group">
                        <label for="motorSpeed">Motor speed [rpm]:</label>
                        <input type="text" id="motorSpeed">
                    </div>                
                </div>

                <div class="campo-multiplo">
                    <div class="input-group">
                        <label for="motorSwitchPosition">Motor switch position:</label>
                        <input type="text" id="motorSwitchPosition">
                    </div>

                    <div class="input-group">
                        <label for="scannerConnected">Scanner connected:</label>
                        <input type="text" id="scannerConnected">
                    </div>

                    <div class="input-group">
                        <label for="flavourCode">Flavour code:</label>
                        <input type="text" id="flavourCode">
                    </div>

                    <div class="input-group">
                        <label for="option">Option:</label>
                        <input type="text" id="option">
                    </div>                
                </div>
            </form>
        </fieldset>

        <div class="section">
            <h2>
                Log
                <button id = "saveButton" class = "action" onclick="scaricaLog()">Save Log</button>
            </h2>
            <div id="log" class="log-area"></div>
        </div>
    </div>

    <script src="modbus_crc16.js"></script>
    <script src="XPress-ble.js"> </script>
    <script src="ble-mon-r2.js"> </script>

</body>
</html>